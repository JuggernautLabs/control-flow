{
  "artifacts": [
    {
      "id": "24e4d072-4695-4ce4-99f2-261e7f1c17f4",
      "artifact_type": "Ticket",
      "content": "\n# Feature Request: Multi-Factor Authentication (MFA)\n\n## Description\nWe need to implement multi-factor authentication to enhance security for user accounts. This should support both SMS and authenticator app-based TOTP.\n\n## Acceptance Criteria\n- [ ] Users can enable/disable MFA in their account settings\n- [ ] Support SMS-based verification codes\n- [ ] Support TOTP authenticator apps (Google Authenticator, Authy, etc.)\n- [ ] Backup codes generation for account recovery\n- [ ] Rate limiting on MFA verification attempts\n- [ ] Audit logging for all MFA events\n- [ ] Graceful fallback if MFA service is unavailable\n\n## Technical Requirements\n- Must integrate with existing JWT authentication\n- Should work with current user session management\n- Need secure storage for MFA secrets\n- Rate limiting: max 5 attempts per 5 minutes\n- Backup codes: 10 single-use codes per user\n\n## Security Considerations\n- MFA secrets must be encrypted at rest\n- SMS codes expire after 5 minutes\n- TOTP codes have 30-second windows\n- Failed attempts should be logged and monitored\n",
      "location": {
        "Ticket": {
          "system": "GitHub",
          "id": "1247"
        }
      },
      "created_at": "2025-05-22T17:06:25.554264Z",
      "author": "security-team@company.com",
      "metadata": {
        "labels": "security,authentication",
        "priority": "high"
      }
    },
    {
      "id": "8c1dcb02-f3b9-4296-b487-649f9d575163",
      "artifact_type": "Code",
      "content": "\nuse crypto::{AES256, HMAC_SHA256};\nuse std::time::{SystemTime, UNIX_EPOCH};\n\n/// Multi-Factor Authentication manager\npub struct MfaManager {\n    secret_key: Vec<u8>,\n    sms_client: SmsClient,\n    rate_limiter: RateLimiter,\n}\n\nimpl MfaManager {\n    /// Generate TOTP secret for a user\n    pub fn generate_totp_secret(&self, user_id: &str) -> Result<String, MfaError> {\n        info!(\"Generating TOTP secret for user: {}\", user_id);\n        \n        let secret = self.generate_random_secret(32)?;\n        let encrypted_secret = self.encrypt_secret(&secret)?;\n        \n        // Store encrypted secret in database\n        self.store_user_secret(user_id, &encrypted_secret)?;\n        \n        Ok(base32::encode(&secret))\n    }\n\n    /// Verify TOTP code from authenticator app  \n    pub fn verify_totp(&self, user_id: &str, code: &str) -> Result<bool, MfaError> {\n        info!(\"Verifying TOTP code for user: {}\", user_id);\n        \n        // Check rate limiting first\n        if !self.rate_limiter.allow_request(user_id) {\n            warn!(\"Rate limit exceeded for user: {}\", user_id);\n            return Err(MfaError::RateLimitExceeded);\n        }\n\n        let encrypted_secret = self.get_user_secret(user_id)?;\n        let secret = self.decrypt_secret(&encrypted_secret)?;\n        \n        // TOTP verification with 30-second window tolerance\n        let current_time = SystemTime::now().duration_since(UNIX_EPOCH)?;\n        let time_steps = current_time.as_secs() / 30;\n        \n        // Check current window and ±1 window for clock skew\n        for step in [time_steps.wrapping_sub(1), time_steps, time_steps + 1] {\n            if self.generate_totp(&secret, step)? == code {\n                self.log_mfa_event(user_id, \"totp_success\");\n                return Ok(true);\n            }\n        }\n        \n        self.log_mfa_event(user_id, \"totp_failure\");\n        Ok(false)\n    }\n\n    /// Send SMS verification code\n    pub async fn send_sms_code(&self, user_id: &str, phone: &str) -> Result<(), MfaError> {\n        info!(\"Sending SMS code to user: {}\", user_id);\n        \n        if !self.rate_limiter.allow_request(user_id) {\n            return Err(MfaError::RateLimitExceeded);\n        }\n\n        let code = self.generate_sms_code();\n        let expires_at = chrono::Utc::now() + chrono::Duration::minutes(5);\n        \n        // Store code with expiration\n        self.store_sms_code(user_id, &code, expires_at)?;\n        \n        // Send via SMS service\n        self.sms_client.send_message(phone, &format!(\"Your verification code: {}\", code)).await?;\n        \n        self.log_mfa_event(user_id, \"sms_sent\");\n        Ok(())\n    }\n\n    /// Generate backup recovery codes\n    pub fn generate_backup_codes(&self, user_id: &str) -> Result<Vec<String>, MfaError> {\n        info!(\"Generating backup codes for user: {}\", user_id);\n        \n        let mut codes = Vec::new();\n        for _ in 0..10 {\n            codes.push(self.generate_backup_code()?);\n        }\n        \n        // Store hashed versions of codes\n        let hashed_codes: Vec<_> = codes.iter()\n            .map(|code| self.hash_backup_code(code))\n            .collect::<Result<Vec<_>, _>>()?;\n        \n        self.store_backup_codes(user_id, &hashed_codes)?;\n        self.log_mfa_event(user_id, \"backup_codes_generated\");\n        \n        Ok(codes)\n    }\n}\n",
      "location": {
        "File": {
          "path": "src/auth/mfa.rs",
          "line_range": [
            1,
            85
          ]
        }
      },
      "created_at": "2025-05-29T17:06:25.554423Z",
      "author": "alice@company.com",
      "metadata": {}
    },
    {
      "id": "72728285-e021-48d1-8a70-9d5bffb64f23",
      "artifact_type": "Test",
      "content": "\n#[cfg(test)]\nmod mfa_tests {\n    use super::*;\n    use tokio_test;\n\n    #[tokio::test]\n    async fn test_totp_generation_and_verification() {\n        let mfa = MfaManager::new_for_testing();\n        let user_id = \"test_user_123\";\n        \n        // Generate TOTP secret\n        let secret = mfa.generate_totp_secret(user_id).unwrap();\n        assert_eq!(secret.len(), 52); // Base32 encoded 32-byte secret\n        \n        // Generate a TOTP code using the secret\n        let totp_code = generate_test_totp(&secret);\n        \n        // Verify the code\n        let result = mfa.verify_totp(user_id, &totp_code).unwrap();\n        assert!(result, \"TOTP verification should succeed\");\n        \n        // Test invalid code\n        let invalid_result = mfa.verify_totp(user_id, \"000000\").unwrap();\n        assert!(!invalid_result, \"Invalid TOTP should fail\");\n    }\n\n    #[tokio::test]\n    async fn test_sms_code_flow() {\n        let mut mfa = MfaManager::new_for_testing();\n        let user_id = \"test_user_456\";\n        let phone = \"+1234567890\";\n        \n        // Send SMS code\n        mfa.send_sms_code(user_id, phone).await.unwrap();\n        \n        // Verify the code was stored\n        let stored_code = mfa.get_stored_sms_code(user_id).unwrap();\n        assert!(stored_code.is_some());\n        \n        // Test verification\n        let code = stored_code.unwrap();\n        let result = mfa.verify_sms_code(user_id, &code).unwrap();\n        assert!(result, \"SMS code verification should succeed\");\n        \n        // Code should be consumed after use\n        let second_result = mfa.verify_sms_code(user_id, &code).unwrap();\n        assert!(!second_result, \"SMS code should only work once\");\n    }\n\n    #[tokio::test]\n    async fn test_rate_limiting() {\n        let mfa = MfaManager::new_for_testing();\n        let user_id = \"test_user_789\";\n        \n        // Make 5 failed attempts (should succeed)\n        for i in 0..5 {\n            let result = mfa.verify_totp(user_id, \"000000\");\n            assert!(result.is_ok(), \"Attempt {} should be allowed\", i + 1);\n        }\n        \n        // 6th attempt should be rate limited\n        let result = mfa.verify_totp(user_id, \"000000\");\n        assert!(matches!(result, Err(MfaError::RateLimitExceeded)));\n    }\n\n    #[test]\n    fn test_backup_codes_generation() {\n        let mfa = MfaManager::new_for_testing();\n        let user_id = \"test_user_backup\";\n        \n        let codes = mfa.generate_backup_codes(user_id).unwrap();\n        \n        // Should generate exactly 10 codes\n        assert_eq!(codes.len(), 10);\n        \n        // Each code should be unique\n        let unique_codes: std::collections::HashSet<_> = codes.iter().collect();\n        assert_eq!(unique_codes.len(), 10);\n        \n        // Codes should be 8 characters long\n        for code in &codes {\n            assert_eq!(code.len(), 8);\n        }\n    }\n\n    #[tokio::test]\n    async fn test_mfa_audit_logging() {\n        let mfa = MfaManager::new_for_testing();\n        let user_id = \"test_user_audit\";\n        \n        // Generate secret (should log event)\n        mfa.generate_totp_secret(user_id).unwrap();\n        \n        // Failed verification (should log event)\n        mfa.verify_totp(user_id, \"000000\").unwrap();\n        \n        // Check audit logs\n        let logs = mfa.get_audit_logs(user_id);\n        assert!(logs.len() >= 2);\n        assert!(logs.iter().any(|log| log.event_type == \"totp_secret_generated\"));\n        assert!(logs.iter().any(|log| log.event_type == \"totp_failure\"));\n    }\n\n    // TODO: Test SMS service failover\n    // TODO: Test encryption/decryption of secrets\n    // TODO: Test backup code verification and consumption\n    // TODO: Test concurrent rate limiting\n}\n",
      "location": {
        "File": {
          "path": "tests/auth/test_mfa.rs",
          "line_range": [
            1,
            95
          ]
        }
      },
      "created_at": "2025-05-31T17:06:25.554425Z",
      "author": "alice@company.com",
      "metadata": {}
    },
    {
      "id": "f83a7afc-3355-44bc-ba7a-5b54c5b33b24",
      "artifact_type": "Documentation",
      "content": "\n# Multi-Factor Authentication API\n\n## Overview\n\nOur MFA system provides additional security for user accounts through SMS and TOTP-based verification.\n\n## Setup Endpoints\n\n### POST /api/v1/mfa/totp/setup\nGenerates a TOTP secret for the authenticated user.\n\n**Response:**\n```json\n{\n  \"secret\": \"JBSWY3DPEHPK3PXP\",\n  \"qr_code\": \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA...\",\n  \"backup_codes\": [\"12345678\", \"87654321\", ...]\n}\n```\n\n### POST /api/v1/mfa/sms/setup\nEnables SMS-based MFA for a phone number.\n\n**Request:**\n```json\n{\n  \"phone_number\": \"+1234567890\"\n}\n```\n\n## Verification Endpoints\n\n### POST /api/v1/mfa/verify\nVerifies an MFA code during login.\n\n**Request:**\n```json\n{\n  \"type\": \"totp\",  // or \"sms\" or \"backup\"\n  \"code\": \"123456\",\n  \"user_id\": \"user123\"\n}\n```\n\n**Response:**\n```json\n{\n  \"valid\": true,\n  \"remaining_attempts\": 4\n}\n```\n\n## Rate Limiting\n\n- **TOTP/SMS verification**: 5 attempts per 5 minutes per user\n- **SMS sending**: 3 SMS per hour per phone number\n- **Backup codes**: 3 attempts per hour per user\n\nRate limit exceeded responses return HTTP 429 with:\n```json\n{\n  \"error\": \"rate_limit_exceeded\",\n  \"retry_after\": 300\n}\n```\n\n## Security Features\n\n✅ **Implemented:**\n- TOTP secrets encrypted at rest using AES-256\n- SMS codes expire after 5 minutes\n- TOTP codes accept ±30 seconds for clock skew\n- Comprehensive audit logging\n- Backup codes for account recovery\n\n⚠️ **Partial Implementation:**\n- Rate limiting (basic implementation, needs refinement)\n- SMS service fallback (single provider only)\n\n❌ **Not Yet Implemented:**\n- Hardware security key support (FIDO2/WebAuthn)\n- Admin override capabilities\n- Bulk MFA operations for enterprise customers\n\n## Error Codes\n\n| Code | Description |\n|------|-------------|\n| `invalid_code` | The provided MFA code is incorrect |\n| `expired_code` | The code has expired (SMS only) |\n| `rate_limit_exceeded` | Too many verification attempts |\n| `mfa_not_enabled` | User has not set up MFA |\n| `service_unavailable` | MFA service temporarily unavailable |\n\n## Integration Example\n\n```javascript\n// Enable TOTP for user\nconst setupResponse = await fetch('/api/v1/mfa/totp/setup', {\n  method: 'POST',\n  headers: {\n    'Authorization': `Bearer ${userToken}`,\n    'Content-Type': 'application/json'\n  }\n});\n\nconst { secret, qr_code, backup_codes } = await setupResponse.json();\n\n// Show QR code to user for scanning with authenticator app\ndisplayQRCode(qr_code);\n\n// Store backup codes securely\nsecurelyStoreBackupCodes(backup_codes);\n```\n",
      "location": {
        "File": {
          "path": "docs/api/mfa.md",
          "line_range": null
        }
      },
      "created_at": "2025-06-02T17:06:25.554427Z",
      "author": "docs-team@company.com",
      "metadata": {}
    },
    {
      "id": "c32abc14-8c1d-4194-ad8b-e207272fdf3c",
      "artifact_type": "Commit",
      "content": "\nfeat(auth): implement TOTP-based multi-factor authentication\n\n- Add MfaManager with TOTP secret generation and verification\n- Implement rate limiting for MFA verification attempts (5 per 5 minutes)\n- Add encrypted storage for TOTP secrets using AES-256\n- Support ±30 second window for TOTP verification to handle clock skew\n- Add comprehensive audit logging for all MFA events\n- Generate 10 single-use backup codes for account recovery\n\nSecurity improvements:\n- All MFA secrets are encrypted at rest\n- Rate limiting prevents brute force attacks\n- Audit logs provide security monitoring capabilities\n\nStill TODO:\n- SMS-based MFA implementation\n- Hardware security key support\n- Admin override capabilities\n\nResolves: #1247\nCo-authored-by: Security Team <security@company.com>\n",
      "location": {
        "Commit": {
          "hash": "a7b3c9d2e1f4567890abcdef1234567890abcdef",
          "file_path": "src/auth/mfa.rs"
        }
      },
      "created_at": "2025-06-03T17:06:25.554428Z",
      "author": "alice@company.com",
      "metadata": {
        "branch": "feature/mfa-implementation",
        "lines_removed": "0",
        "lines_added": "145"
      }
    }
  ],
  "claims": [
    {
      "id": "9f8a3e44-97f9-4978-97c6-4461fabbbff1",
      "artifact_id": "24e4d072-4695-4ce4-99f2-261e7f1c17f4",
      "statement": "Multi-factor authentication (MFA) must be implemented for user accounts",
      "extraction_confidence": 1.0,
      "claim_type": "Requirement",
      "source_excerpt": "We need to implement multi-factor authentication to enhance security for user accounts",
      "extracted_at": "2025-06-05T17:06:36.276585Z"
    },
    {
      "id": "e6d18f93-c386-4fae-aefc-0d162736344a",
      "artifact_id": "24e4d072-4695-4ce4-99f2-261e7f1c17f4",
      "statement": "MFA must support both SMS and TOTP authenticator app verification methods",
      "extraction_confidence": 1.0,
      "claim_type": "Functional",
      "source_excerpt": "Support SMS-based verification codes, Support TOTP authenticator apps (Google Authenticator, Authy, etc.)",
      "extracted_at": "2025-06-05T17:06:36.276595Z"
    },
    {
      "id": "c86c0a3a-ca90-4939-9e5f-3569d8567f7c",
      "artifact_id": "24e4d072-4695-4ce4-99f2-261e7f1c17f4",
      "statement": "Users can enable and disable MFA in account settings",
      "extraction_confidence": 1.0,
      "claim_type": "Functional",
      "source_excerpt": "Users can enable/disable MFA in their account settings",
      "extracted_at": "2025-06-05T17:06:36.276598Z"
    },
    {
      "id": "f14453ff-c97f-43c4-a2f7-e3efba4e5e7c",
      "artifact_id": "24e4d072-4695-4ce4-99f2-261e7f1c17f4",
      "statement": "System must generate backup codes for account recovery",
      "extraction_confidence": 1.0,
      "claim_type": "Requirement",
      "source_excerpt": "Backup codes generation for account recovery",
      "extracted_at": "2025-06-05T17:06:36.276602Z"
    },
    {
      "id": "721c41bc-0da7-4165-8b32-d920062225f5",
      "artifact_id": "24e4d072-4695-4ce4-99f2-261e7f1c17f4",
      "statement": "MFA verification attempts must be rate limited",
      "extraction_confidence": 1.0,
      "claim_type": "Security",
      "source_excerpt": "Rate limiting: max 5 attempts per 5 minutes",
      "extracted_at": "2025-06-05T17:06:36.276605Z"
    },
    {
      "id": "6292ad07-2746-4aa1-b4c0-cbd98b6dc1a7",
      "artifact_id": "24e4d072-4695-4ce4-99f2-261e7f1c17f4",
      "statement": "MFA secrets must be encrypted at rest",
      "extraction_confidence": 1.0,
      "claim_type": "Security",
      "source_excerpt": "MFA secrets must be encrypted at rest",
      "extracted_at": "2025-06-05T17:06:36.276610Z"
    },
    {
      "id": "3193197e-d18e-419d-b865-1b1fe4ae2608",
      "artifact_id": "24e4d072-4695-4ce4-99f2-261e7f1c17f4",
      "statement": "SMS verification codes expire after 5 minutes",
      "extraction_confidence": 1.0,
      "claim_type": "Security",
      "source_excerpt": "SMS codes expire after 5 minutes",
      "extracted_at": "2025-06-05T17:06:36.276614Z"
    },
    {
      "id": "80ed5c4f-ed98-44d0-9701-039006a362d6",
      "artifact_id": "24e4d072-4695-4ce4-99f2-261e7f1c17f4",
      "statement": "TOTP codes have 30-second validity windows",
      "extraction_confidence": 1.0,
      "claim_type": "Security",
      "source_excerpt": "TOTP codes have 30-second windows",
      "extracted_at": "2025-06-05T17:06:36.276617Z"
    },
    {
      "id": "8d48a94e-896a-4500-b563-fefd9d032c2b",
      "artifact_id": "24e4d072-4695-4ce4-99f2-261e7f1c17f4",
      "statement": "MFA must integrate with existing JWT authentication",
      "extraction_confidence": 1.0,
      "claim_type": "Structure",
      "source_excerpt": "Must integrate with existing JWT authentication",
      "extracted_at": "2025-06-05T17:06:36.276621Z"
    },
    {
      "id": "09203863-1fb5-4967-8b76-35659fdfd4d5",
      "artifact_id": "24e4d072-4695-4ce4-99f2-261e7f1c17f4",
      "statement": "System must generate 10 single-use backup codes per user",
      "extraction_confidence": 1.0,
      "claim_type": "Requirement",
      "source_excerpt": "Backup codes: 10 single-use codes per user",
      "extracted_at": "2025-06-05T17:06:36.276626Z"
    },
    {
      "id": "3c01667d-9cb5-4e87-bf0a-eb97bd2eaac7",
      "artifact_id": "8c1dcb02-f3b9-4296-b487-649f9d575163",
      "statement": "The system provides multi-factor authentication (MFA) management",
      "extraction_confidence": 1.0,
      "claim_type": "Functional",
      "source_excerpt": "pub struct MfaManager",
      "extracted_at": "2025-06-05T17:06:38.737694Z"
    },
    {
      "id": "26808c8f-2029-44be-992c-07289326372d",
      "artifact_id": "8c1dcb02-f3b9-4296-b487-649f9d575163",
      "statement": "Supports TOTP (Time-based One-Time Password) authentication",
      "extraction_confidence": 1.0,
      "claim_type": "Functional",
      "source_excerpt": "pub fn generate_totp_secret(&self, user_id: &str) -> Result<String, MfaError>",
      "extracted_at": "2025-06-05T17:06:38.737699Z"
    },
    {
      "id": "cdc8a1c4-ad48-4ad0-abd7-3d81c53c81ae",
      "artifact_id": "8c1dcb02-f3b9-4296-b487-649f9d575163",
      "statement": "Implements SMS-based verification code functionality",
      "extraction_confidence": 1.0,
      "claim_type": "Functional",
      "source_excerpt": "pub async fn send_sms_code(&self, user_id: &str, phone: &str) -> Result<(), MfaError>",
      "extracted_at": "2025-06-05T17:06:38.737701Z"
    },
    {
      "id": "362fa022-934f-4c5c-8137-112539a8e726",
      "artifact_id": "8c1dcb02-f3b9-4296-b487-649f9d575163",
      "statement": "Provides backup recovery code generation",
      "extraction_confidence": 1.0,
      "claim_type": "Functional",
      "source_excerpt": "pub fn generate_backup_codes(&self, user_id: &str) -> Result<Vec<String>, MfaError>",
      "extracted_at": "2025-06-05T17:06:38.737703Z"
    },
    {
      "id": "9161a2f8-7565-4282-b7b5-42fb39292ea5",
      "artifact_id": "8c1dcb02-f3b9-4296-b487-649f9d575163",
      "statement": "Implements rate limiting for authentication attempts",
      "extraction_confidence": 1.0,
      "claim_type": "Security",
      "source_excerpt": "if !self.rate_limiter.allow_request(user_id) { return Err(MfaError::RateLimitExceeded); }",
      "extracted_at": "2025-06-05T17:06:38.737705Z"
    },
    {
      "id": "9c049f42-e655-4db7-83a5-251ade83dac9",
      "artifact_id": "8c1dcb02-f3b9-4296-b487-649f9d575163",
      "statement": "Uses encryption for storing secrets",
      "extraction_confidence": 0.9,
      "claim_type": "Security",
      "source_excerpt": "let encrypted_secret = self.encrypt_secret(&secret)?;",
      "extracted_at": "2025-06-05T17:06:38.737707Z"
    },
    {
      "id": "a797bdb2-12d9-4ba3-a4de-1e8e3bd2b9dc",
      "artifact_id": "8c1dcb02-f3b9-4296-b487-649f9d575163",
      "statement": "Supports multiple time windows for TOTP verification to handle clock skew",
      "extraction_confidence": 0.9,
      "claim_type": "Behavior",
      "source_excerpt": "for step in [time_steps.wrapping_sub(1), time_steps, time_steps + 1]",
      "extracted_at": "2025-06-05T17:06:38.737709Z"
    },
    {
      "id": "5ff3c0f7-1bea-408c-bc30-045b3216404c",
      "artifact_id": "8c1dcb02-f3b9-4296-b487-649f9d575163",
      "statement": "Generates and stores backup codes securely",
      "extraction_confidence": 0.9,
      "claim_type": "Security",
      "source_excerpt": "let hashed_codes: Vec<_> = codes.iter().map(|code| self.hash_backup_code(code)).collect()",
      "extracted_at": "2025-06-05T17:06:38.737712Z"
    },
    {
      "id": "0b4126e3-dde8-4bc8-91e4-88f45536ffaf",
      "artifact_id": "8c1dcb02-f3b9-4296-b487-649f9d575163",
      "statement": "Provides logging for multi-factor authentication events",
      "extraction_confidence": 0.8,
      "claim_type": "Functional",
      "source_excerpt": "self.log_mfa_event(user_id, \"totp_success\")",
      "extracted_at": "2025-06-05T17:06:38.737714Z"
    },
    {
      "id": "7e377e78-71a4-490a-bf74-ea7e6de052e3",
      "artifact_id": "8c1dcb02-f3b9-4296-b487-649f9d575163",
      "statement": "SMS verification codes have a time-limited expiration",
      "extraction_confidence": 0.9,
      "claim_type": "Security",
      "source_excerpt": "let expires_at = chrono::Utc::now() + chrono::Duration::minutes(5)",
      "extracted_at": "2025-06-05T17:06:38.737717Z"
    },
    {
      "id": "e617a61a-daf3-4649-b551-a2e94dbef038",
      "artifact_id": "72728285-e021-48d1-8a70-9d5bffb64f23",
      "statement": "TOTP secrets are 52 characters long and base32 encoded",
      "extraction_confidence": 0.9,
      "claim_type": "Functional",
      "source_excerpt": "assert_eq!(secret.len(), 52); // Base32 encoded 32-byte secret",
      "extracted_at": "2025-06-05T17:06:36.865613Z"
    },
    {
      "id": "e23ae0cb-32b7-4b49-9951-b5ea693ff787",
      "artifact_id": "72728285-e021-48d1-8a70-9d5bffb64f23",
      "statement": "TOTP verification supports valid and invalid codes",
      "extraction_confidence": 1.0,
      "claim_type": "Behavior",
      "source_excerpt": "let result = mfa.verify_totp(user_id, &totp_code).unwrap(); assert!(result)",
      "extracted_at": "2025-06-05T17:06:36.865619Z"
    },
    {
      "id": "2945d012-b8d5-4326-9dee-d8d1280d5fbe",
      "artifact_id": "72728285-e021-48d1-8a70-9d5bffb64f23",
      "statement": "SMS codes can only be verified once",
      "extraction_confidence": 1.0,
      "claim_type": "Behavior",
      "source_excerpt": "let second_result = mfa.verify_sms_code(user_id, &code).unwrap(); assert!(!second_result)",
      "extracted_at": "2025-06-05T17:06:36.865622Z"
    },
    {
      "id": "4aa3f2c0-f99e-4cbe-a80b-90fcb6ddf4f3",
      "artifact_id": "72728285-e021-48d1-8a70-9d5bffb64f23",
      "statement": "MFA system implements rate limiting for verification attempts",
      "extraction_confidence": 0.9,
      "claim_type": "Security",
      "source_excerpt": "// 6th attempt should be rate limited\nlet result = mfa.verify_totp(user_id, \"000000\");\nassert!(matches!(result, Err(MfaError::RateLimitExceeded)))",
      "extracted_at": "2025-06-05T17:06:36.865625Z"
    },
    {
      "id": "2b9b625d-6b2f-4c67-bd02-0f121c116741",
      "artifact_id": "72728285-e021-48d1-8a70-9d5bffb64f23",
      "statement": "Backup codes are generated with specific characteristics",
      "extraction_confidence": 1.0,
      "claim_type": "Functional",
      "source_excerpt": "assert_eq!(codes.len(), 10);\nassert_eq!(unique_codes.len(), 10);\nassert_eq!(code.len(), 8)",
      "extracted_at": "2025-06-05T17:06:36.865627Z"
    },
    {
      "id": "c0eee3df-da45-4418-af7c-e41956767334",
      "artifact_id": "72728285-e021-48d1-8a70-9d5bffb64f23",
      "statement": "MFA system supports audit logging for key events",
      "extraction_confidence": 0.8,
      "claim_type": "Security",
      "source_excerpt": "assert!(logs.iter().any(|log| log.event_type == \"totp_secret_generated\"));\nassert!(logs.iter().any(|log| log.event_type == \"totp_failure\"))",
      "extracted_at": "2025-06-05T17:06:36.865630Z"
    },
    {
      "id": "7b313fca-b2cb-4ea4-92ab-6577ce91162f",
      "artifact_id": "72728285-e021-48d1-8a70-9d5bffb64f23",
      "statement": "There are pending test implementations for additional MFA scenarios",
      "extraction_confidence": 0.7,
      "claim_type": "Testing",
      "source_excerpt": "// TODO: Test SMS service failover\n// TODO: Test encryption/decryption of secrets\n// TODO: Test backup code verification and consumption\n// TODO: Test concurrent rate limiting",
      "extracted_at": "2025-06-05T17:06:36.865633Z"
    },
    {
      "id": "6eadd4e0-01d1-497a-8fb3-ddeb87257bdf",
      "artifact_id": "f83a7afc-3355-44bc-ba7a-5b54c5b33b24",
      "statement": "The MFA system supports TOTP-based multi-factor authentication",
      "extraction_confidence": 1.0,
      "claim_type": "Functional",
      "source_excerpt": "Our MFA system provides additional security for user accounts through SMS and TOTP-based verification.",
      "extracted_at": "2025-06-05T17:06:36.180831Z"
    },
    {
      "id": "1a944886-3a89-42ed-a23c-755aa39a94d5",
      "artifact_id": "f83a7afc-3355-44bc-ba7a-5b54c5b33b24",
      "statement": "The system supports SMS-based multi-factor authentication",
      "extraction_confidence": 1.0,
      "claim_type": "Functional",
      "source_excerpt": "Our MFA system provides additional security for user accounts through SMS and TOTP-based verification.",
      "extracted_at": "2025-06-05T17:06:36.180841Z"
    },
    {
      "id": "94e18cbf-e145-42f3-80d3-8c2d9e73d181",
      "artifact_id": "f83a7afc-3355-44bc-ba7a-5b54c5b33b24",
      "statement": "TOTP secrets are encrypted at rest using AES-256",
      "extraction_confidence": 1.0,
      "claim_type": "Security",
      "source_excerpt": "TOTP secrets encrypted at rest using AES-256",
      "extracted_at": "2025-06-05T17:06:36.180846Z"
    },
    {
      "id": "072fa0e4-1211-4feb-9caa-0ef7d7b5fbdd",
      "artifact_id": "f83a7afc-3355-44bc-ba7a-5b54c5b33b24",
      "statement": "SMS codes expire after 5 minutes",
      "extraction_confidence": 1.0,
      "claim_type": "Security",
      "source_excerpt": "SMS codes expire after 5 minutes",
      "extracted_at": "2025-06-05T17:06:36.180848Z"
    },
    {
      "id": "0b5c15e3-5f72-4f2a-80c8-d656c2181dd9",
      "artifact_id": "f83a7afc-3355-44bc-ba7a-5b54c5b33b24",
      "statement": "TOTP codes have a ±30 seconds clock skew tolerance",
      "extraction_confidence": 1.0,
      "claim_type": "Behavior",
      "source_excerpt": "TOTP codes accept ±30 seconds for clock skew",
      "extracted_at": "2025-06-05T17:06:36.180850Z"
    },
    {
      "id": "00ea07ff-fee5-4333-b210-de8bef7b8f4e",
      "artifact_id": "f83a7afc-3355-44bc-ba7a-5b54c5b33b24",
      "statement": "The system has comprehensive audit logging",
      "extraction_confidence": 0.9,
      "claim_type": "Security",
      "source_excerpt": "Comprehensive audit logging",
      "extracted_at": "2025-06-05T17:06:36.180854Z"
    },
    {
      "id": "b21efa95-b337-4925-9e38-59936e05b774",
      "artifact_id": "f83a7afc-3355-44bc-ba7a-5b54c5b33b24",
      "statement": "Rate limiting is implemented with 5 verification attempts per 5 minutes per user",
      "extraction_confidence": 1.0,
      "claim_type": "Security",
      "source_excerpt": "TOTP/SMS verification: 5 attempts per 5 minutes per user",
      "extracted_at": "2025-06-05T17:06:36.180856Z"
    },
    {
      "id": "764e3ded-9835-4979-bc20-59d6b37d9dd2",
      "artifact_id": "f83a7afc-3355-44bc-ba7a-5b54c5b33b24",
      "statement": "SMS sending is limited to 3 SMS per hour per phone number",
      "extraction_confidence": 1.0,
      "claim_type": "Performance",
      "source_excerpt": "SMS sending: 3 SMS per hour per phone number",
      "extracted_at": "2025-06-05T17:06:36.180858Z"
    },
    {
      "id": "94762f9d-2c1b-48cb-9283-730781d8a630",
      "artifact_id": "f83a7afc-3355-44bc-ba7a-5b54c5b33b24",
      "statement": "Backup codes are available for account recovery",
      "extraction_confidence": 1.0,
      "claim_type": "Functional",
      "source_excerpt": "Backup codes for account recovery",
      "extracted_at": "2025-06-05T17:06:36.180860Z"
    },
    {
      "id": "0d9ebbeb-34b3-4b86-90a3-be796d3a1b12",
      "artifact_id": "f83a7afc-3355-44bc-ba7a-5b54c5b33b24",
      "statement": "Hardware security key support is not yet implemented",
      "extraction_confidence": 1.0,
      "claim_type": "Requirement",
      "source_excerpt": "Hardware security key support (FIDO2/WebAuthn) - Not Yet Implemented",
      "extracted_at": "2025-06-05T17:06:36.180874Z"
    },
    {
      "id": "4854191c-d1ad-43cb-bf53-617318a853e9",
      "artifact_id": "c32abc14-8c1d-4194-ad8b-e207272fdf3c",
      "statement": "Implement TOTP-based multi-factor authentication",
      "extraction_confidence": 1.0,
      "claim_type": "Functional",
      "source_excerpt": "feat(auth): implement TOTP-based multi-factor authentication",
      "extracted_at": "2025-06-05T17:06:35.907919Z"
    },
    {
      "id": "cfbb89c4-0c73-46a3-9c30-64e4ff03588d",
      "artifact_id": "c32abc14-8c1d-4194-ad8b-e207272fdf3c",
      "statement": "MfaManager supports TOTP secret generation and verification",
      "extraction_confidence": 1.0,
      "claim_type": "Functional",
      "source_excerpt": "Add MfaManager with TOTP secret generation and verification",
      "extracted_at": "2025-06-05T17:06:35.907928Z"
    },
    {
      "id": "50af1439-4575-4d7b-8a82-5c8541537336",
      "artifact_id": "c32abc14-8c1d-4194-ad8b-e207272fdf3c",
      "statement": "Rate limit MFA verification to 5 attempts per 5 minutes",
      "extraction_confidence": 1.0,
      "claim_type": "Security",
      "source_excerpt": "Implement rate limiting for MFA verification attempts (5 per 5 minutes)",
      "extracted_at": "2025-06-05T17:06:35.907931Z"
    },
    {
      "id": "bc1ab831-e984-44af-a0cc-bff422d1aa5e",
      "artifact_id": "c32abc14-8c1d-4194-ad8b-e207272fdf3c",
      "statement": "TOTP secrets are encrypted using AES-256",
      "extraction_confidence": 1.0,
      "claim_type": "Security",
      "source_excerpt": "Add encrypted storage for TOTP secrets using AES-256",
      "extracted_at": "2025-06-05T17:06:35.907933Z"
    },
    {
      "id": "3519d306-f1ee-4ebf-a240-ffddbb54fd10",
      "artifact_id": "c32abc14-8c1d-4194-ad8b-e207272fdf3c",
      "statement": "TOTP verification allows ±30 second time window",
      "extraction_confidence": 1.0,
      "claim_type": "Functional",
      "source_excerpt": "Support ±30 second window for TOTP verification to handle clock skew",
      "extracted_at": "2025-06-05T17:06:35.907936Z"
    },
    {
      "id": "36efae9a-4e73-47e8-bf5a-1dcd104ac812",
      "artifact_id": "c32abc14-8c1d-4194-ad8b-e207272fdf3c",
      "statement": "Comprehensive audit logging for all MFA events",
      "extraction_confidence": 0.9,
      "claim_type": "Security",
      "source_excerpt": "Add comprehensive audit logging for all MFA events",
      "extracted_at": "2025-06-05T17:06:35.907939Z"
    },
    {
      "id": "7ba7ff00-0618-46b3-809c-e8813cd9e790",
      "artifact_id": "c32abc14-8c1d-4194-ad8b-e207272fdf3c",
      "statement": "Generate 10 single-use backup codes for account recovery",
      "extraction_confidence": 1.0,
      "claim_type": "Functional",
      "source_excerpt": "Generate 10 single-use backup codes for account recovery",
      "extracted_at": "2025-06-05T17:06:35.907942Z"
    },
    {
      "id": "0f967628-4cc0-4ff7-b025-601500897992",
      "artifact_id": "c32abc14-8c1d-4194-ad8b-e207272fdf3c",
      "statement": "MFA secrets are encrypted at rest",
      "extraction_confidence": 1.0,
      "claim_type": "Security",
      "source_excerpt": "All MFA secrets are encrypted at rest",
      "extracted_at": "2025-06-05T17:06:35.907944Z"
    },
    {
      "id": "ba05b7de-07b1-4c8f-b20b-935225294729",
      "artifact_id": "c32abc14-8c1d-4194-ad8b-e207272fdf3c",
      "statement": "Future plans include SMS-based MFA and hardware security key support",
      "extraction_confidence": 0.7,
      "claim_type": "Requirement",
      "source_excerpt": "Still TODO: - SMS-based MFA implementation\n- Hardware security key support",
      "extracted_at": "2025-06-05T17:06:35.907947Z"
    }
  ],
  "alignments": [
    {
      "id": "484ce513-d3a2-4f70-b541-735dc9b319e6",
      "claim_id": "9f8a3e44-97f9-4978-97c6-4461fabbbff1",
      "evidence_artifact_id": "72728285-e021-48d1-8a70-9d5bffb64f23",
      "alignment_score": 0.85,
      "explanation": "The test artifact provides comprehensive evidence for multi-factor authentication implementation, covering multiple authentication methods and security considerations",
      "checked_at": "2025-06-05T17:06:45.295365Z"
    },
    {
      "id": "5af1b123-69a7-43ce-9515-58a834996490",
      "claim_id": "f14453ff-c97f-43c4-a2f7-e3efba4e5e7c",
      "evidence_artifact_id": "72728285-e021-48d1-8a70-9d5bffb64f23",
      "alignment_score": 0.9,
      "explanation": "The evidence provides strong, direct support for the claim of generating backup codes for account recovery. The test case `test_backup_codes_generation` specifically validates the backup code generation functionality.",
      "checked_at": "2025-06-05T17:09:14.129897Z"
    },
    {
      "id": "8b537eaa-5229-4ccb-98c3-c03b8e67b56c",
      "claim_id": "f14453ff-c97f-43c4-a2f7-e3efba4e5e7c",
      "evidence_artifact_id": "f83a7afc-3355-44bc-ba7a-5b54c5b33b24",
      "alignment_score": 0.95,
      "explanation": "The evidence provides comprehensive support for generating backup codes for account recovery, with explicit implementation details and clear documentation",
      "checked_at": "2025-06-05T17:06:50.881781Z"
    },
    {
      "id": "e8d0f272-58ac-4e29-bd28-0e0023d37774",
      "claim_id": "6292ad07-2746-4aa1-b4c0-cbd98b6dc1a7",
      "evidence_artifact_id": "72728285-e021-48d1-8a70-9d5bffb64f23",
      "alignment_score": 0.3,
      "explanation": "The evidence does not directly address the claim that MFA secrets must be encrypted at rest. While the test suite covers various MFA functionality, there is no explicit test or implementation of encryption for secrets.",
      "checked_at": "2025-06-05T17:07:02.085750Z"
    },
    {
      "id": "07e4503d-e655-4c51-b73f-34bf5efc2316",
      "claim_id": "80ed5c4f-ed98-44d0-9701-039006a362d6",
      "evidence_artifact_id": "f83a7afc-3355-44bc-ba7a-5b54c5b33b24",
      "alignment_score": 0.9,
      "explanation": "The evidence provides strong, direct support for the claim that TOTP codes have 30-second validity windows",
      "checked_at": "2025-06-05T17:07:15.191547Z"
    },
    {
      "id": "46883e74-0c97-492c-a850-59202c138afc",
      "claim_id": "9c049f42-e655-4db7-83a5-251ade83dac9",
      "evidence_artifact_id": "72728285-e021-48d1-8a70-9d5bffb64f23",
      "alignment_score": 0.4,
      "explanation": "The evidence does not directly demonstrate or test encryption for storing secrets. While the test suite covers multiple MFA functionality aspects, there is no explicit test or implementation of secret encryption. A TODO comment suggests future encryption testing is planned.",
      "checked_at": "2025-06-05T17:08:00.573472Z"
    },
    {
      "id": "ebfa7ddb-760e-4150-81b3-29d52b3b4170",
      "claim_id": "5ff3c0f7-1bea-408c-bc30-045b3216404c",
      "evidence_artifact_id": "c32abc14-8c1d-4194-ad8b-e207272fdf3c",
      "alignment_score": 0.8,
      "explanation": "The evidence provides strong support for generating and securely storing backup codes, with explicit mention of backup code generation and implicit security measures",
      "checked_at": "2025-06-05T17:08:14.275655Z"
    },
    {
      "id": "87670741-563a-4272-a8a1-8888592a7693",
      "claim_id": "2945d012-b8d5-4326-9dee-d8d1280d5fbe",
      "evidence_artifact_id": "8c1dcb02-f3b9-4296-b487-649f9d575163",
      "alignment_score": 0.3,
      "explanation": "The evidence does not directly support the claim that 'SMS codes can only be verified once'. The SMS verification method does not implement a single-use constraint.",
      "checked_at": "2025-06-05T17:08:41.877157Z"
    },
    {
      "id": "6ee102a0-a790-4dea-8cc4-bf6c67864524",
      "claim_id": "2945d012-b8d5-4326-9dee-d8d1280d5fbe",
      "evidence_artifact_id": "c32abc14-8c1d-4194-ad8b-e207272fdf3c",
      "alignment_score": 0.3,
      "explanation": "The evidence artifact provides no direct support for the claim that SMS codes can only be verified once. The commit message discusses TOTP (Time-based One-Time Password) implementation and mentions SMS-based MFA as a TODO item, without specifying code verification behavior.",
      "checked_at": "2025-06-05T17:08:43.781587Z"
    }
  ],
  "analysis_summary": {
    "total_claims": 46,
    "total_alignments": 184,
    "alignments_checked": 9,
    "alignment_limit_reached": true,
    "average_alignment_score": 0.6333333333333333,
    "strong_alignments_count": 5,
    "moderate_alignments_count": 1,
    "weak_alignments_count": 3
  },
  "timestamp": "2025-06-05T17:09:14.357797Z"
}